
<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Päivän Mieliala</title>
    <style>
        /* --- 1. VISUAL SETUP (TYYLIT) --- */
        body {
            background-color: white !important;
            color: black !important;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
            touch-action: manipulation; 
        }
        
        /* Header Container to hold Title and History Button */
        .header-container {
            background-color: #f0f0f0;
            border-bottom: 3px solid #ccc;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        h1 {
            font-size: 2rem; color: #333; margin: 0;
        }

        /* New History Button Style */
        .history-btn-main {
            background-color: #e0e0e0;
            border: 2px solid #ccc;
            padding: 8px 20px;
            font-size: 1.1rem;
            border-radius: 20px;
            cursor: pointer;
            color: #555;
            font-weight: bold;
        }

        /* --- 2. MAIN SCREEN LAYOUT --- */
        .container {
            display: flex; flex: 1; width: 100%; padding: 15px; box-sizing: border-box;
            align-items: center; justify-content: center; gap: 15px;
        }

        .mood-btn {
            flex: 1; aspect-ratio: 1 / 1; max-width: 400px;
            border: none; outline: none; cursor: pointer; padding: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            transition: transform 0.1s;
        }
        .mood-btn:active { transform: scale(0.98); }

        .btn-title-text {
            font-size: 1.6rem; font-weight: bold; color: #222;
            margin-bottom: 15px; text-align: center;
        }

        .main-img {
            width: auto; height: auto; max-width: 80%; max-height: 65%;
            object-fit: contain;
        }

        /* Background Colors */
        .bg-bad { background-color: #ffeaea; border: 4px solid #ffcccc;}
        .bg-okay { background-color: #fff8e1; border: 4px solid #ffe0b2;}
        .bg-good { background-color: #e8f5e9; border: 4px solid #c8e6c9;}


        /* --- 3. POPUP WINDOWS (IKKUNAT) --- */
        /* Shared styles for both modals */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85); 
            justify-content: center; align-items: center;
            z-index: 999;
        }
        .modal-box {
            background-color: white; padding: 25px;
            border-radius: 20px; width: 90%; max-width: 600px;
            text-align: center; max-height: 90vh; overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-title { font-size: 2.2rem; margin-bottom: 25px; font-weight: bold;}

        /* --- 4. REASON GRID --- */
        .options-grid {
            display: none; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;
        }
        .reason-btn {
            background-color: #f8f8f8; border: 3px solid #eee;
            border-radius: 15px; padding: 15px;
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
        }
        .reason-btn:active { background-color: #e0e0e0; border-color: #ccc;}
        .reason-img { width: 90px; height: 90px; object-fit: contain; margin-bottom: 10px;}
        .reason-text { font-size: 1.4rem; font-weight: bold; color: #444; }

        /* --- 5. HISTORY GRID STYLES --- */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7 columns for Mon-Sun */
            gap: 5px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .day-slot {
            display: flex; flex-direction: column; align-items: center;
        }
        .day-label { font-weight: bold; margin-bottom: 5px; color: #666; font-size: 0.9rem;}
        .day-indicator {
            width: 40px; height: 40px;
            border-radius: 50%;
            background-color: #eee; /* Default gray */
            border: 3px solid #ddd;
        }
        /* Small indicators for history */
        .ind-bad { background-color: #ff6b6b; border-color: #d63031; }
        .ind-okay { background-color: #feca57; border-color: #ff9f43; }
        .ind-good { background-color: #1dd1a1; border-color: #10ac84; }

        /* Buttons in modals */
        .close-btn {
            margin-top: 10px; padding: 15px 40px; font-size: 1.6rem; font-weight: bold;
            background-color: #666; color: white; border: none; cursor: pointer;
            border-radius: 12px; width: 100%;
        }
        
        /* --- NEW: Clear History Button Style --- */
        .clear-btn {
            margin-top: 20px; /* Space above it */
            padding: 15px 40px; font-size: 1.6rem; font-weight: bold;
            background-color: #ff6b6b; /* Reddish color for "delete" action */
            color: white; border: none; cursor: pointer;
            border-radius: 12px; width: 100%;
        }
        .clear-btn:active { background-color: #d63031; }
    </style>
</head>
<body>

    <div class="header-container">
        <h1 id="status-text">Miten päiväsi meni?</h1>
        <button id="btn-open-history" class="history-btn-main">Näytä Historia</button>
    </div>

    <div class="container">
        <button id="btn-bad" class="mood-btn bg-bad">
            <span class="btn-title-text">Huono päivä</span>
            <img src="bad.jpg" alt="Huono" class="main-img">
        </button>
        <button id="btn-okay" class="mood-btn bg-okay">
             <span class="btn-title-text">Tavallinen päivä</span>
            <img src="okay.jpg" alt="Normaali" class="main-img">
        </button>
        <button id="btn-good" class="mood-btn bg-good">
             <span class="btn-title-text">Hyvä päivä</span>
            <img src="good.jpg" alt="Hyvä" class="main-img">
        </button>
    </div>

    <div id="modal-reason" class="modal-overlay">
        <div class="modal-box">
            <h2 id="modal-title-reason" class="modal-title">Miksi?</h2>

            <div id="grid-bad" class="options-grid">
                <button id="btn-pain" class="reason-btn">
                    <img src="pain.jpg" class="reason-img"><span class="reason-text">Kipu</span>
                </button>
                <button id="btn-toilet" class="reason-btn">
                    <img src="toilet.jpg" class="reason-img"><span class="reason-text">Vessa</span>
                </button>
                <button id="btn-lonely" class="reason-btn">
                    <img src="lonely.jpg" class="reason-img"><span class="reason-text">Yksinäinen</span>
                </button>
                <button id="btn-tired" class="reason-btn">
                    <img src="tired.jpg" class="reason-img"><span class="reason-text">Väsynyt</span>
                </button>
            </div>

            <div id="grid-good" class="options-grid">
                <button id="btn-family" class="reason-btn">
                    <img src="family.jpg" class="reason-img"><span class="reason-text">Perhe</span>
                </button>
                <button id="btn-food" class="reason-btn">
                    <img src="food.jpg" class="reason-img"><span class="reason-text">Ruoka</span>
                </button>
                <button id="btn-music" class="reason-btn">
                    <img src="music.jpg" class="reason-img"><span class="reason-text">Musiikki</span>
                </button>
                <button id="btn-comfort" class="reason-btn">
                    <img src="comfort.jpg" class="reason-img"><span class="reason-text">Hyvä olo</span>
                </button>
            </div>

            <button id="btn-cancel-reason" class="close-btn">Peruuta</button>
        </div>
    </div>

    <div id="modal-history" class="modal-overlay">
        <div class="modal-box">
            <h2 class="modal-title">Tämän viikon historia</h2>
            <p style="color:#666;">(Tiedot tallentuvat tämän laitteen selaimeen)</p>
            
            <div id="weekly-display" class="week-grid">
                </div>

            <button id="btn-clear-history" class="clear-btn">Tyhjennä historia</button>

            <button id="btn-close-history" class="close-btn">Sulje</button>
        </div>
    </div>

    <script>
        // --- SCRIPT ---
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- LOAD DATA ON STARTUP ---
            const STORAGE_KEY = 'moodAppHistoryV1';
            var sessionHistory = [];
            var savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                sessionHistory = JSON.parse(savedData);
                console.log("Historia ladattu muistista:", sessionHistory.length, "merkintää.");
            } else {
                console.log("Ei aiempaa historiaa muistissa.");
            }

            // Get elements
            var statusText = document.getElementById('status-text');
            var modalReason = document.getElementById('modal-reason');
            var modalHistory = document.getElementById('modal-history');
            var gridBad = document.getElementById('grid-bad');
            var gridGood = document.getElementById('grid-good');
            var reasonTitle = document.getElementById('modal-title-reason');
            var weeklyDisplay = document.getElementById('weekly-display');

            // --- MAIN BUTTON CLICKS ---
            document.getElementById('btn-bad').addEventListener('click', function() {
                openReasonModal('bad');
            });
            document.getElementById('btn-good').addEventListener('click', function() {
                openReasonModal('good');
            });
            document.getElementById('btn-okay').addEventListener('click', function() {
                saveResult('Tavallinen', 'Normaali', 'ind-okay');
            });

            // Open/Close History
            document.getElementById('btn-open-history').addEventListener('click', function() {
                 generateWeeklyView();
                 modalHistory.style.display = 'flex';
            });
             document.getElementById('btn-close-history').addEventListener('click', function() {
                 modalHistory.style.display = 'none';
            });

            // Close Reason Modal
            document.getElementById('btn-cancel-reason').addEventListener('click', function() {
                modalReason.style.display = "none";
            });

            // --- NEW: CLEAR HISTORY BUTTON ---
            document.getElementById('btn-clear-history').addEventListener('click', function() {
                // Ask for confirmation first
                if (confirm("Oletko varma? Tämä poistaa kaiken tallennetun historian tältä laitteelta.")) {
                    // 1. Empty RAM array
                    sessionHistory = [];
                    // 2. Remove from Local Storage cupboard
                    localStorage.removeItem(STORAGE_KEY);
                    // 3. Redraw the grid immediately so dots turn grey
                    generateWeeklyView();
                    console.log("Historia tyhjennetty.");
                }
            });


            // --- REASON CLICKS (Attach Handlers) ---
            ['pain','toilet','lonely','tired'].forEach(r => {
                document.getElementById('btn-'+r).addEventListener('click', () => saveResult('Huono', translate(r), 'ind-bad'));
            });
            ['family','food','music','comfort'].forEach(r => {
                document.getElementById('btn-'+r).addEventListener('click', () => saveResult('Hyvä', translate(r), 'ind-good'));
            });

            // --- FUNCTIONS ---

            function openReasonModal(type) {
                modalReason.style.display = "flex";
                if(type === 'bad') {
                    gridBad.style.display = "grid"; gridGood.style.display = "none";
                    reasonTitle.innerText = "Mikä on huonosti?";
                } else {
                    gridGood.style.display = "grid"; gridBad.style.display = "none";
                    reasonTitle.innerText = "Mikä oli hyvin?";
                }
            }

            function saveResult(moodText, reasonText, indicatorClass) {
                modalReason.style.display = "none";

                var today = new Date();
                var dateString = today.toISOString().split('T')[0];
                
                // Add to current list
                sessionHistory.push({
                    dateStr: dateString,
                    moodClass: indicatorClass
                });

                // SAVE TO LOCAL STORAGE
                localStorage.setItem(STORAGE_KEY, JSON.stringify(sessionHistory));

                // Update status text
                statusText.innerText = "Tallennettu: " + moodText + " (" + reasonText + ")";
                statusText.style.backgroundColor = "#d4edda"; 
                
                setTimeout(function() {
                    statusText.innerText = "Miten päiväsi meni?";
                    statusText.style.backgroundColor = "transparent"; 
                }, 3000);
            }

            function getMonday(d) {
              d = new Date(d);
              var day = d.getDay(),
                  diff = d.getDate() - day + (day == 0 ? -6:1); 
              return new Date(d.setDate(diff));
            }

            function generateWeeklyView() {
                weeklyDisplay.innerHTML = ""; 
                var FinnishDays = ['MA', 'TI', 'KE', 'TO', 'PE', 'LA', 'SU'];
                
                var monday = getMonday(new Date());

                for(var i=0; i<7; i++) {
                    var slotDate = new Date(monday);
                    slotDate.setDate(monday.getDate() + i);
                    var slotDateStr = slotDate.toISOString().split('T')[0];

                    var foundMoodClass = ""; 
                    // Search backwards to find the most recent one for that day
                    for(var k=sessionHistory.length-1; k>=0; k--) {
                        if(sessionHistory[k].dateStr === slotDateStr) {
                            foundMoodClass = sessionHistory[k].moodClass;
                            break; 
                        }
                    }

                    var slotHtml = `
                        <div class="day-slot">
                            <span class="day-label">${FinnishDays[i]}</span>
                            <div class="day-indicator ${foundMoodClass}"></div>
                        </div>
                    `;
                    weeklyDisplay.insertAdjacentHTML('beforeend', slotHtml);
                }
            }

            function translate(word) {
                const map = { 'pain':'Kipu','toilet':'Vessa','lonely':'Yksinäinen','tired':'Väsynyt','family':'Perhe','food':'Ruoka','music':'Musiikki','comfort':'Hyvä olo' };
                return map[word] || word;
            }

        });
    </script>

</body>
</html>
