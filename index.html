<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BD Tour Alicante 2026</title>

    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        golf: {
                            dark: '#0A2615',   /* Augusta Green */
                            deep: '#1B4D3E',   /* Secondary Green */
                            gold: '#C5A059',   /* Trophy Gold */
                            cream: '#F5F5F0',  /* Card Stock */
                            white: '#FFFFFF'
                        }
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Lato"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* --- SMART SCROLL LOGIC --- */
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #F5F5F0;
        }

        #app-container {
            height: 100%;
            width: 100%;
            overflow-y: auto; 
            overscroll-behavior-y: none; 
            -webkit-overflow-scrolling: touch;
        }

        /* Checkbox Styling */
        input[type="checkbox"]:checked + label {
            text-decoration: line-through;
            color: #9CA3AF;
        }
        
        /* Editor Styles */
        .rich-editor {
            min-height: 80px;
            max-height: 200px;
            overflow-y: auto;
            background-color: white;
            overscroll-behavior-y: contain; 
        }
        .rich-editor:focus {
            outline: 2px solid #C5A059;
        }

        /* Accordion Animation */
        .accordion-content {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 1000px; 
            opacity: 1;
        }
        .arrow-icon {
            transition: transform 0.3s ease;
        }
        .arrow-icon.rotate {
            transform: rotate(180deg);
        }
        
        /* Classes for JS Physics target */
        .anim-obj {
            transform-origin: center;
            transform-box: fill-box;
            will-change: transform; 
        }

        #landscape-warning { display: none; }
        @media screen and (orientation: landscape) {
            #app-container { display: none; }
            #landscape-warning { display: flex; }
        }
    </style>
</head>
<body class="bg-golf-cream text-gray-800 font-sans antialiased">

    <div id="landscape-warning" class="fixed inset-0 bg-golf-dark z-[100] flex flex-col items-center justify-center text-golf-gold p-10 text-center">
        <div class="text-6xl mb-4">âŸ³</div>
        <h2 class="font-serif text-3xl mb-2">Portrait Mode Only</h2>
    </div>

    <div id="app-container" class="max-w-md mx-auto bg-golf-cream shadow-2xl relative flex flex-col">

        <header class="bg-golf-dark pt-10 pb-8 px-6 text-center rounded-b-[30px] shadow-lg z-10 relative overflow-hidden shrink-0">
            
            <svg id="header-glass" class="absolute bottom-0 right-0 w-48 h-auto opacity-10 text-golf-gold transform translate-x-4 translate-y-2" viewBox="0 0 200 200" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                
                <path d="M40 40 L160 40 L100 120 L100 180 M70 180 L130 180" stroke="currentColor" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                
                <line x1="50" y1="50" x2="150" y2="50" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4" opacity="0.5" />

                <g>
                    <g id="anim-stick" class="anim-obj">
                         <line x1="0" y1="20" x2="20" y2="-20" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
                    </g>

                    <g id="anim-ball" class="anim-obj">
                        <circle cx="0" cy="0" r="18" fill="currentColor"/>
                        <circle cx="-5" cy="-5" r="2" fill="white" opacity="0.5"/>
                        <circle cx="5" cy="-5" r="2" fill="white" opacity="0.5"/>
                    </g>
                </g>
            </svg>

            <div class="relative z-10 pointer-events-none">
                <h1 class="font-serif text-2xl text-white tracking-wide leading-tight drop-shadow-md">
                    BD TOUR<br>
                    <span class="text-golf-gold italic text-xl">Alicante 2026</span>
                </h1>
                
                <button onclick="document.getElementById('packing-modal').classList.remove('hidden'); event.stopPropagation();" class="pointer-events-auto mt-4 bg-golf-deep border border-golf-gold text-golf-gold text-[10px] uppercase tracking-widest py-1.5 px-6 rounded-full hover:bg-black transition flex items-center justify-center mx-auto gap-2 shadow-lg">
                    <span>âœ“</span> Packing List
                </button>
            </div>
        </header>

        <main class="p-4 space-y-3 pb-24">
            
            <div class="bg-white rounded-sm border-t-2 border-golf-gold shadow-sm overflow-hidden">
                <button onclick="toggleAccordion('acc-flight', 'arrow-flight')" class="w-full flex justify-between items-center p-4 bg-white hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-golf-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        <h3 class="font-serif text-base text-golf-deep font-bold">Flight Plan</h3>
                    </div>
                    <svg id="arrow-flight" class="arrow-icon w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="acc-flight" class="accordion-content border-t border-gray-100">
                    <div class="p-4 pt-2">
                        <div id="view-flight" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-sm border-t-2 border-golf-dark shadow-sm overflow-hidden">
                <button onclick="toggleAccordion('acc-rounds', 'arrow-rounds')" class="w-full flex justify-between items-center p-4 bg-white hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-golf-deep" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 21v-8a2 2 0 012-2h14l-3 4 3 4H5a2 2 0 01-2-2z"></path></svg>
                        <h3 class="font-serif text-base text-golf-deep font-bold">Golf Rounds</h3>
                    </div>
                    <svg id="arrow-rounds" class="arrow-icon w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="acc-rounds" class="accordion-content border-t border-gray-100">
                    <div class="p-4 pt-2">
                        <div id="view-rounds" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-sm border-t-2 border-golf-gold shadow-sm overflow-hidden">
                <button onclick="toggleAccordion('acc-teams', 'arrow-teams')" class="w-full flex justify-between items-center p-4 bg-white hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-golf-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                        <h3 class="font-serif text-base text-golf-deep font-bold">Team Rosters</h3>
                    </div>
                    <svg id="arrow-teams" class="arrow-icon w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="acc-teams" class="accordion-content border-t border-gray-100">
                    <div class="p-4 pt-2">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-bold text-xs text-golf-gold uppercase mb-2 border-b border-gray-100 pb-1">Team 1</h4>
                                <div id="view-team1" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                            </div>
                            <div>
                                <h4 class="font-bold text-xs text-golf-deep uppercase mb-2 border-b border-gray-100 pb-1">Team 2</h4>
                                <div id="view-team2" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-sm border-t-2 border-golf-deep shadow-sm overflow-hidden">
                <button onclick="toggleAccordion('acc-hotel', 'arrow-hotel')" class="w-full flex justify-between items-center p-4 bg-white hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-golf-deep" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                        <h3 class="font-serif text-base text-golf-deep font-bold">Accommodation</h3>
                    </div>
                    <svg id="arrow-hotel" class="arrow-icon w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="acc-hotel" class="accordion-content border-t border-gray-100">
                    <div class="p-4 pt-2">
                        <div id="view-hotel" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-sm border-t-2 border-golf-gold shadow-sm overflow-hidden">
                <button onclick="toggleAccordion('acc-dinner', 'arrow-dinner')" class="w-full flex justify-between items-center p-4 bg-white hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-golf-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                        <h3 class="font-serif text-base text-golf-deep font-bold">Dining & Events</h3>
                    </div>
                    <svg id="arrow-dinner" class="arrow-icon w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="acc-dinner" class="accordion-content border-t border-gray-100">
                    <div class="p-4 pt-2">
                        <div id="view-dinner" class="text-xs leading-relaxed text-gray-600 whitespace-pre-line">Loading...</div>
                    </div>
                </div>
            </div>

            <div id="quote-container" class="mt-8 px-6 text-center min-h-[40px] flex items-center justify-center">
                <p id="quote-text" class="text-golf-gold italic font-serif text-xs leading-relaxed transition-opacity duration-1000 opacity-0">
                    </p>
            </div>

            <div class="text-center pt-4 pb-2">
                <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="text-[9px] text-gray-300 hover:text-golf-gold uppercase tracking-widest opacity-50 mb-2">
                    Chairman Access
                </button>
                <p class="text-[9px] text-gray-300">
                    Last sync: <span id="last-sync">...</span>
                </p>
            </div>
        </main>
    </div>

    <div id="packing-modal" class="hidden fixed inset-0 bg-golf-dark/95 z-50 flex flex-col items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-sm shadow-2xl overflow-hidden flex flex-col max-h-[85vh]">
            
            <div class="bg-golf-gold p-3 text-center flex justify-between items-center shrink-0">
                <div class="w-6"></div>
                <h2 class="font-serif text-lg font-bold text-golf-dark">Packing List</h2>
                <button onclick="document.getElementById('packing-modal').classList.add('hidden')" class="text-golf-dark font-bold text-xl hover:text-white">Ã—</button>
            </div>

            <div class="overflow-y-auto flex-1 p-6 space-y-6">
                
                <div>
                    <h3 class="text-xs font-bold text-golf-deep uppercase tracking-widest mb-3 border-b border-gray-100 pb-1">Essentials</h3>
                    <div id="list-essentials" class="space-y-3">
                        <p class="text-xs text-gray-400 italic">Loading...</p>
                    </div>
                </div>

                <div>
                    <h3 class="text-xs font-bold text-golf-deep uppercase tracking-widest mb-3 border-b border-gray-100 pb-1">Personal Items</h3>
                    
                    <div class="flex gap-2 mb-4">
                        <input id="new-item-input" type="text" placeholder="Add item..." class="flex-1 bg-gray-50 border border-gray-200 rounded-sm px-2 py-1 text-sm outline-none focus:border-golf-gold">
                        <button onclick="addPersonalItem()" class="bg-golf-deep text-white px-3 py-1 rounded-sm text-xs font-bold hover:bg-black">+</button>
                    </div>

                    <div id="list-personal" class="space-y-3">
                        </div>
                </div>

            </div>
            
            <button onclick="document.getElementById('packing-modal').classList.add('hidden')" class="bg-gray-100 p-3 text-center text-xs font-bold text-gray-500 hover:bg-gray-200 uppercase tracking-wide shrink-0">
                Close
            </button>
        </div>
    </div>

    <div id="login-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-xs p-8 rounded-sm shadow-2xl text-center">
            <h2 class="font-serif text-2xl text-golf-dark mb-6">Chairman Login</h2>
            <input type="email" id="email" placeholder="Email" class="w-full bg-gray-50 border-b-2 border-gray-200 p-3 mb-4 outline-none">
            <input type="password" id="password" placeholder="Password" class="w-full bg-gray-50 border-b-2 border-gray-200 p-3 mb-6 outline-none">
            <button id="btn-login" class="w-full bg-golf-dark text-golf-gold font-bold py-3 uppercase tracking-wider text-sm">Authenticate</button>
            <button onclick="document.getElementById('login-modal').classList.add('hidden')" class="mt-4 text-xs text-gray-400 underline">Cancel</button>
        </div>
    </div>

    <div id="editor-panel" class="hidden fixed inset-0 bg-gray-100 z-[60] flex flex-col">
        
        <div class="bg-golf-deep text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <h2 class="font-serif font-bold">Edit Itinerary</h2>
            <button onclick="document.getElementById('editor-panel').classList.add('hidden')" class="text-xs bg-black/20 px-3 py-1 rounded hover:bg-black/40">Close</button>
        </div>
        
        <div class="bg-gray-200 p-3 border-b border-gray-300 sticky top-0 z-20 flex justify-center shadow-sm">
            <button onmousedown="event.preventDefault(); format('strikeThrough')" class="bg-golf-gold text-golf-dark font-bold text-xs uppercase tracking-widest py-3 px-6 rounded shadow hover:brightness-110 w-full max-w-xs flex items-center justify-center gap-2">
                <span><s>ABC</s></span> Mark Selection as Done
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-6">
            
            <div>
                <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Flight Plan</label>
                <div id="edit-flight" contenteditable="true" class="rich-editor w-full p-3 text-sm border rounded"></div>
            </div>

            <div>
                <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Golf Rounds</label>
                <div id="edit-rounds" contenteditable="true" class="rich-editor w-full p-3 text-sm border rounded"></div>
            </div>

            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Team 1</label>
                    <div id="edit-team1" contenteditable="true" class="rich-editor w-full p-2 text-sm border rounded"></div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Team 2</label>
                    <div id="edit-team2" contenteditable="true" class="rich-editor w-full p-2 text-sm border rounded"></div>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Accommodation</label>
                <div id="edit-hotel" contenteditable="true" class="rich-editor w-full p-3 text-sm border rounded"></div>
            </div>

            <div>
                <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Dining</label>
                <div id="edit-dinner" contenteditable="true" class="rich-editor w-full p-3 text-sm border rounded"></div>
            </div>

            <div class="bg-yellow-50 p-3 rounded border border-yellow-100">
                <label class="block text-xs font-bold text-golf-dark uppercase mb-1">Essentials Packing List</label>
                <p class="text-[10px] text-gray-500 mb-2">Items listed here appear for everyone. One item per line.</p>
                <textarea id="edit-packing-essentials" rows="6" class="w-full p-3 text-sm border rounded font-sans"></textarea>
            </div>

            <button id="btn-save" class="w-full bg-golf-deep text-white font-bold py-4 rounded shadow-lg text-sm uppercase tracking-widest mt-4 mb-10">
                Save Updates Live
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ðŸ”¥ðŸ”¥ðŸ”¥ PASTE FIREBASE CONFIG HERE ðŸ”¥ðŸ”¥ðŸ”¥
        const firebaseConfig = {
apiKey: "AIzaSyBQZPcQ6FcnglNHg10d__6PQDdd_OjT74U",
authDomain: "golfapp-10c53.firebaseapp.com",
projectId: "golfapp-10c53",
storageBucket: "golfapp-10c53.firebasestorage.app",
messagingSenderId: "251112200135",
appId: "1:251112200135:web:6b1d0386a2cc042ae8abe2"
        };
        // ðŸ”¥ðŸ”¥ðŸ”¥ END PASTE ðŸ”¥ðŸ”¥ðŸ”¥

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const tripRef = doc(db, "trip", "details");

        // --- AUTOMATIC LAVA LAMP ANIMATION (Safe Constraints) ---
        const stickEl = document.getElementById('anim-stick');
        const ballEl = document.getElementById('anim-ball');
        
        function animateBubbles() {
            const time = Date.now();

            // 1. BALL ANIMATION (Low, Tight Cycle)
            // Center X=100. Range +/- 8.
            // Center Y=85. Range +/- 4.
            const ballX = 100 + Math.sin(time * 0.0005) * 8; 
            const ballY = 85 + Math.cos(time * 0.0008) * 4; 
            
            if(ballEl) {
                ballEl.setAttribute('transform', `translate(${ballX}, ${ballY})`);
            }

            // 2. STICK ANIMATION (Higher, Wider, Rotate)
            // Center X=100. Range +/- 10.
            // Center Y=65. Range +/- 5.
            // Rotation +/- 8 degrees.
            const stickX = 100 + Math.sin(time * 0.0003 + 2) * 10;
            const stickY = 65 + Math.cos(time * 0.0004) * 5;
            const stickRot = Math.sin(time * 0.0002) * 8;

            if(stickEl) {
                // translate first, then rotate around its center
                stickEl.setAttribute('transform', `translate(${stickX}, ${stickY}) rotate(${stickRot})`);
            }

            requestAnimationFrame(animateBubbles);
        }

        // Start animation loop
        animateBubbles();
        // --- END ANIMATION ---

        // GLOBAL VARS
        let globalEssentialsList = [];

        // --- PACKING LIST LOGIC ---
        window.renderPackingLists = function() {
            // A. Render Essentials
            const essentialsContainer = document.getElementById('list-essentials');
            essentialsContainer.innerHTML = '';
            const localChecks = JSON.parse(localStorage.getItem('essentialsChecks') || '{}');

            if (globalEssentialsList.length === 0) {
                essentialsContainer.innerHTML = '<p class="text-xs text-gray-400 italic">No essentials added yet.</p>';
            } else {
                globalEssentialsList.forEach((itemText, index) => {
                    if(!itemText.trim()) return;
                    const div = document.createElement('div');
                    div.className = "flex items-center gap-3";
                    const checkbox = document.createElement('input');
                    checkbox.type = "checkbox";
                    checkbox.id = `essential-${index}`;
                    checkbox.className = "w-5 h-5 accent-golf-deep rounded cursor-pointer";
                    checkbox.checked = !!localChecks[itemText];
                    checkbox.onchange = () => toggleEssential(itemText);
                    const label = document.createElement('label');
                    label.htmlFor = `essential-${index}`;
                    label.innerText = itemText;
                    label.className = "cursor-pointer select-none text-sm text-gray-700";
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    essentialsContainer.appendChild(div);
                });
            }

            // B. Render Personal
            const personalContainer = document.getElementById('list-personal');
            personalContainer.innerHTML = '';
            const personalItems = JSON.parse(localStorage.getItem('userPackingPersonal') || '[]');

            if (personalItems.length === 0) {
                personalContainer.innerHTML = '<p class="text-xs text-gray-400 italic">No personal items.</p>';
            } else {
                personalItems.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = "flex items-center justify-between group";
                    const leftDiv = document.createElement('div');
                    leftDiv.className = "flex items-center gap-3";
                    const checkbox = document.createElement('input');
                    checkbox.type = "checkbox";
                    checkbox.id = `personal-${index}`;
                    checkbox.className = "w-5 h-5 accent-golf-deep rounded cursor-pointer";
                    checkbox.checked = item.checked;
                    checkbox.onchange = () => togglePersonal(index);
                    const label = document.createElement('label');
                    label.htmlFor = `personal-${index}`;
                    label.innerText = item.text;
                    label.className = "cursor-pointer select-none text-sm text-gray-700";
                    leftDiv.appendChild(checkbox);
                    leftDiv.appendChild(label);
                    const delBtn = document.createElement('button');
                    delBtn.innerHTML = "&times;";
                    delBtn.className = "text-gray-300 hover:text-red-500 font-bold text-lg px-2";
                    delBtn.onclick = () => deletePersonal(index);
                    div.appendChild(leftDiv);
                    div.appendChild(delBtn);
                    personalContainer.appendChild(div);
                });
            }
        }

        window.toggleEssential = function(itemName) {
            const localChecks = JSON.parse(localStorage.getItem('essentialsChecks') || '{}');
            if (localChecks[itemName]) delete localChecks[itemName];
            else localChecks[itemName] = true;
            localStorage.setItem('essentialsChecks', JSON.stringify(localChecks));
        }

        window.addPersonalItem = function() {
            const input = document.getElementById('new-item-input');
            const text = input.value.trim();
            if(!text) return;
            const personalItems = JSON.parse(localStorage.getItem('userPackingPersonal') || '[]');
            personalItems.push({ text: text, checked: false });
            localStorage.setItem('userPackingPersonal', JSON.stringify(personalItems));
            input.value = "";
            renderPackingLists();
        }

        window.togglePersonal = function(index) {
            const personalItems = JSON.parse(localStorage.getItem('userPackingPersonal') || '[]');
            personalItems[index].checked = !personalItems[index].checked;
            localStorage.setItem('userPackingPersonal', JSON.stringify(personalItems));
        }

        window.deletePersonal = function(index) {
            const personalItems = JSON.parse(localStorage.getItem('userPackingPersonal') || '[]');
            personalItems.splice(index, 1);
            localStorage.setItem('userPackingPersonal', JSON.stringify(personalItems));
            renderPackingLists();
        }

        // --- QUOTES ---
        const quotes = [
            "The most important shot in golf is the next one. â€“ Ben Hogan",
            "Golf is a good walk spoiled. â€“ Mark Twain",
            "Success in golf depends less on strength of body than upon strength of mind. â€“ Arnold Palmer",
            "I have a tip that can take five strokes off anyone's game: it's called an eraser. â€“ Arnold Palmer",
            "Golf is deceptive. It looks so simple, yet it's endlessly complicated. â€“ Arnold Palmer",
            "A bad day at golf is better than a good day at work.",
            "Golf is a game of inches. The most important are the six inches between your ears. â€“ Bobby Jones",
            "The harder you work, the luckier you get. â€“ Gary Player",
            "My swing is so bad I look like a caveman killing his lunch. â€“ Lee Trevino",
            "Golf is 90% mental and 10% mental. â€“ Humor",
            "If you watch a game, it's fun. If you play it, it's recreation. If you work at it, it's golf. â€“ Bob Hope",
            "I play with friends, but we don't play friendly games. â€“ Ben Hogan",
            "Forget your opponents; always play against par. â€“ Sam Snead",
            "The object of golf is not just to win. It is to play like a gentleman, and win. â€“ Phil Mickelson",
            "Swing hard in case you hit it. â€“ Dan Marino",
            "It takes hundreds of good golf shots to gain confidence, but only one bad one to lose it. â€“ Jack Nicklaus",
            "You donâ€™t know what pressure is until you play for five bucks with only two bucks in your pocket. â€“ Lee Trevino",
            "Golf... is the infallible test of integrity and self-control. â€“ P.G. Wodehouse",
            "Keep your head down and follow through.",
            "Drive for show, putt for dough."
        ];

        const quoteEl = document.getElementById('quote-text');
        function cycleQuote() {
            quoteEl.classList.remove('opacity-100');
            quoteEl.classList.add('opacity-0');
            setTimeout(() => {
                const random = quotes[Math.floor(Math.random() * quotes.length)];
                quoteEl.innerText = `"${random}"`;
                quoteEl.classList.remove('opacity-0');
                quoteEl.classList.add('opacity-100');
            }, 1000); 
        }
        cycleQuote();
        setInterval(cycleQuote, 8000); 

        // HELPERS
        window.format = function(command) { document.execCommand(command, false, null); };

        window.toggleAccordion = function(contentId, arrowId) {
            const clickedContent = document.getElementById(contentId);
            const clickedArrow = document.getElementById(arrowId);
            const isAlreadyOpen = clickedContent.classList.contains('open');
            const allContents = document.querySelectorAll('.accordion-content');
            const allArrows = document.querySelectorAll('.arrow-icon');
            allContents.forEach(el => el.classList.remove('open'));
            allArrows.forEach(el => el.classList.remove('rotate'));
            if (!isAlreadyOpen) {
                clickedContent.classList.add('open');
                clickedArrow.classList.add('rotate');
            }
        };

        // 1. DATA LISTENER
        onSnapshot(tripRef, (doc) => {
            if (doc.exists()) {
                const data = doc.data();
                const now = new Date();
                document.getElementById('last-sync').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

                document.getElementById('view-flight').innerHTML = data.flights || "Details pending...";
                document.getElementById('view-rounds').innerHTML = data.rounds || "Course details pending...";
                document.getElementById('view-team1').innerHTML = data.team1 || "Roster pending...";
                document.getElementById('view-team2').innerHTML = data.team2 || "Roster pending...";
                document.getElementById('view-hotel').innerHTML = data.hotel || "Details pending...";
                document.getElementById('view-dinner').innerHTML = data.dinner || "Details pending...";
                
                document.getElementById('edit-flight').innerHTML = data.flights || "";
                document.getElementById('edit-rounds').innerHTML = data.rounds || "";
                document.getElementById('edit-team1').innerHTML = data.team1 || "";
                document.getElementById('edit-team2').innerHTML = data.team2 || "";
                document.getElementById('edit-hotel').innerHTML = data.hotel || "";
                document.getElementById('edit-dinner').innerHTML = data.dinner || "";
                document.getElementById('edit-packing-essentials').value = data.packing_list || "";

                if (data.packing_list) {
                    globalEssentialsList = data.packing_list.split('\n');
                } else {
                    globalEssentialsList = ["Passport", "Clubs", "Golf Shoes", "Tees"];
                }
                renderPackingLists();
            }
        });

        // 2. LOGIN
        document.getElementById('btn-login').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('editor-panel').classList.remove('hidden');
            } catch (error) {
                alert("Access Denied.");
            }
        });

        // 3. SAVE
        document.getElementById('btn-save').addEventListener('click', async () => {
            const btn = document.getElementById('btn-save');
            btn.innerText = "Saving...";
            try {
                await updateDoc(tripRef, {
                    flights: document.getElementById('edit-flight').innerHTML,
                    rounds: document.getElementById('edit-rounds').innerHTML,
                    team1: document.getElementById('edit-team1').innerHTML,
                    team2: document.getElementById('edit-team2').innerHTML,
                    hotel: document.getElementById('edit-hotel').innerHTML,
                    dinner: document.getElementById('edit-dinner').innerHTML,
                    packing_list: document.getElementById('edit-packing-essentials').value
                });
                document.getElementById('editor-panel').classList.add('hidden');
            } catch (error) {
                alert("Error saving: " + error.message);
            }
            btn.innerText = "Save Updates Live";
        });
    </script>
</body>
</html>